CREATE ALGORITHM=MERGE DEFINER=`root`@`localhost` SQL SECURITY DEFINER VIEW `c01`.`view_mir` AS select `tbl_details`.`ID` AS `OrderDetailsID`,`c01`.`tbl_order`.`ID` AS `OrderID`,`c01`.`tbl_order`.`Approved` AS `OrderApproved`,`c01`.`tbl_customer`.`ID` AS `CustomerID`,concat(`c01`.`tbl_customer`.`LastName`,' ',`c01`.`tbl_customer`.`FirstName`) AS `CustomerName`,`policy1`.`ID` AS `CustomerInsuranceID_1`,`insco1`.`ID` AS `InsuranceCompanyID_1`,`policy2`.`ID` AS `CustomerInsuranceID_2`,`insco2`.`ID` AS `InsuranceCompanyID_2`,`c01`.`tbl_cmnform`.`ID` AS `CMNFormID`,`c01`.`tbl_facility`.`ID` AS `FacilityID`,`tbl_doctor`.`ID` AS `DoctorID`,`tbl_details`.`SaleRentType` AS `SaleRentType`,`tbl_details`.`BillingCode` AS `BillingCode`,concat_ws(', ',if((`tbl_details`.`BillIns1` = 1),'Ins1',NULL),if((`tbl_details`.`BillIns2` = 1),'Ins2',NULL),if((`tbl_details`.`BillIns3` = 1),'Ins3',NULL),if((`tbl_details`.`BillIns4` = 1),'Ins4',NULL),'Patient') AS `Payers`,`c01`.`tbl_inventoryitem`.`Name` AS `InventoryItem`,`c01`.`tbl_pricecode`.`Name` AS `PriceCode`,concat_ws(', ',if((`c01`.`tbl_order`.`MIR` <> ''),'order',NULL),if((`tbl_details`.`MIR` <> ''),'details',NULL),if((0 < find_in_set('CustomerID',`c01`.`tbl_order`.`MIR`)),'customer required',NULL),if((0 < find_in_set('Customer.Inactive',`c01`.`tbl_order`.`MIR`)),'customer inactive',NULL),if((0 < find_in_set('Customer.MIR',`c01`.`tbl_order`.`MIR`)),'customer',NULL),if((0 < find_in_set('Facility.MIR',`c01`.`tbl_order`.`MIR`)),'facility',NULL),if((0 < find_in_set('Policy1.Required',`c01`.`tbl_order`.`MIR`)),'policy1 required',NULL),if((0 < find_in_set('Policy1.MIR',`c01`.`tbl_order`.`MIR`)),'policy1',NULL),if((0 < find_in_set('Policy2.Required',`c01`.`tbl_order`.`MIR`)),'policy2 required',NULL),if((0 < find_in_set('Policy2.MIR',`c01`.`tbl_order`.`MIR`)),'policy2',NULL),if((0 < find_in_set('CMNForm.Required',`tbl_details`.`MIR`)),'cmn form required',NULL),if((0 < find_in_set('CMNForm.MIR',`tbl_details`.`MIR`)),'cmn form',NULL),if((0 < find_in_set('Answers',`c01`.`tbl_cmnform`.`MIR`)),'cmn answers',NULL),NULL) AS `MIR`,concat_ws('\r\n',if((`c01`.`tbl_order`.`MIR` <> ''),replace(concat('Order: ',cast(`c01`.`tbl_order`.`MIR` as char charset latin1)),',',', '),NULL),if((`tbl_details`.`MIR` <> ''),replace(concat('Details: ',cast(`tbl_details`.`MIR` as char charset latin1)),',',', '),NULL),if((`c01`.`tbl_customer`.`MIR` <> ''),replace(concat('Customer: ',cast(`c01`.`tbl_customer`.`MIR` as char charset latin1)),',',', '),NULL),if((`tbl_doctor`.`MIR` <> ''),replace(concat('Doctor: ',cast(`tbl_doctor`.`MIR` as char charset latin1)),',',', '),NULL),if((`policy1`.`MIR` <> ''),replace(concat('Policy 1: ',cast(`policy1`.`MIR` as char charset latin1)),',',', '),NULL),if((`insco1`.`MIR` <> ''),replace(concat('Ins Co 1: ',cast(`insco1`.`MIR` as char charset latin1)),',',', '),NULL),if((`policy2`.`MIR` <> ''),replace(concat('Policy 2: ',cast(`policy2`.`MIR` as char charset latin1)),',',', '),NULL),if((`insco2`.`MIR` <> ''),replace(concat('Ins Co 2: ',cast(`insco2`.`MIR` as char charset latin1)),',',', '),NULL),if((`c01`.`tbl_cmnform`.`MIR` <> ''),replace(concat('CMN Form: ',cast(`c01`.`tbl_cmnform`.`MIR` as char charset latin1)),',',', '),NULL),if((`c01`.`tbl_facility`.`MIR` <> ''),replace(concat('Facility: ',cast(`c01`.`tbl_facility`.`MIR` as char charset latin1)),',',', '),NULL),NULL) AS `Details` from ((((((((((((`c01`.`view_orderdetails_core` `tbl_details` join `c01`.`tbl_order` on(((`tbl_details`.`OrderID` = `c01`.`tbl_order`.`ID`) and (`tbl_details`.`CustomerID` = `c01`.`tbl_order`.`CustomerID`)))) join `c01`.`tbl_customer` on((`tbl_details`.`CustomerID` = `c01`.`tbl_customer`.`ID`))) left join `c01`.`tbl_doctor` on((`c01`.`tbl_customer`.`Doctor1_ID` = `tbl_doctor`.`ID`))) left join `c01`.`tbl_facility` on((`c01`.`tbl_order`.`FacilityID` = `c01`.`tbl_facility`.`ID`))) left join `c01`.`tbl_cmnform` on(((`tbl_details`.`CMNFormID` = `c01`.`tbl_cmnform`.`ID`) and (`tbl_details`.`CustomerID` = `c01`.`tbl_cmnform`.`CustomerID`)))) left join `c01`.`tbl_inventoryitem` on((`tbl_details`.`InventoryItemID` = `c01`.`tbl_inventoryitem`.`ID`))) left join `c01`.`tbl_pricecode` on((`tbl_details`.`PriceCodeID` = `c01`.`tbl_pricecode`.`ID`))) left join `c01`.`tbl_customer_insurance` `policy1` on(((`policy1`.`CustomerID` = `c01`.`tbl_order`.`CustomerID`) and (`policy1`.`ID` = `c01`.`tbl_order`.`CustomerInsurance1_ID`)))) left join `c01`.`tbl_insurancecompany` `insco1` on((`insco1`.`ID` = `policy1`.`InsuranceCompanyID`))) left join `c01`.`tbl_customer_insurance` `policy2` on(((`policy2`.`CustomerID` = `c01`.`tbl_order`.`CustomerID`) and (`policy2`.`ID` = `c01`.`tbl_order`.`CustomerInsurance2_ID`) and (`tbl_details`.`BillIns2` = 1)))) left join `c01`.`tbl_insurancecompany` `insco2` on((`insco2`.`ID` = `policy2`.`InsuranceCompanyID`))) join `c01`.`tbl_company` on((`c01`.`tbl_company`.`ID` = 1))) where (((`c01`.`tbl_company`.`Show_InactiveCustomers` = 1) or isnull(`c01`.`tbl_customer`.`InactiveDate`) or (now() < `c01`.`tbl_customer`.`InactiveDate`)) and (`tbl_details`.`IsActive` = 1) and ((`tbl_details`.`MIR` <> '') or (`c01`.`tbl_order`.`MIR` <> '')))